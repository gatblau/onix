[OSEv3:children]
masters
nodes
postdeploy_glusterfs
etcd

[OSEv3:vars]
ansible_ssh_user: deploy-user
ansible_become: "yes"

openshift_deployment_type: openshift-enterprise

openshift_disable_check: disk_availability,docker_image_availability,docker_storage,memory_availability,package_availability,package_version

# uncomment below if registering to a Satellite server
#redhat_satellite_fqdn: satellite.example.com
#redhat_organization_id: mycompany
#redhat_activationkey: mykey

# configure openshift_node_sdn_mtu if required default is 1500.
#openshift_node_sdn_mtu: 1374

containerized: "True"
openshift_release: 3.9.30
openshift_image_tag: v3.9.30

#patch to restrict rhe stroage plugin to specified version. There is a bug in heketi3.9 so we have explicitly setup this as 3.10. It is wise to use glusterfs 3.4 instead of glusterfs3.3
openshift_storage_glusterfs_heketi_version: v3.10

oreg_url: registry.access.redhat.com/openshift3/ose-${component}:${version}
openshift_examples_modify_imagestreams: true

openshift_docker_additional_registries: ['registry.access.redhat.com']
#openshift_docker_insecure_registries: []

openshift_master_api_port: 443
openshift_master_console_port: 443

# disable installation of broker when the core openshift is installed
ansible_service_broker_install: False

# enable installation of broker separately after core openshift is installed
postdeploy_ansible_service_broker_install: True

# Proxy settings
openshift_http_proxy: "http://proxy.example.com:8080"
openshift_https_proxy: "http://proxy.example.com:8080"
openshift_no_proxy: 'local,localhost,localdomain,svc,my.openshift.domain.com'

# Identity configuration - IDM
# openshift_master_identity_providers: [{'name': 'IDM', 'challenge': 'true', 'login': 'true', 'kind': 'LDAPPasswordIdentityProvider', 'attributes': {'id': ['dn'], 'email': ['mail'], 'name': ['cn'], 'preferredUsername': ['uid']}, 'bindDN': 'cn=directory manager', 'bindPassword': 'password_here', 'insecure': 'true', 'url': 'ldap://ldapserver:389/cn=users,cn=accounts,dc=domain,dc=com?uid'}]

# Identity configuration - HTPASSWD
#openshift_master_identity_providers: [{'name': 'htpasswd_auth', 'login': 'true', 'challenge': 'true', 'kind': 'HTPasswdPasswordIdentityProvider','filename': '/etc/origin/master/htpasswd'}]
#openshift_master_htpasswd_file: "/usr/share/ansible/openshift-ansible/htpasswd/.htpasswd"
openshift_master_htpasswd_users: {'admin': 'my_admin_password_hash', 'user': 'my_user_password_hash'}

# Identity configuration - OpenID
#openshift_master_openid_ca_file: "{{ additional_assets }}/openidserver.crt"
#openshift_master_identity_providers: [{"name": "openid_auth", "login": "true", "challenge": "false", "kind": "OpenIDIdentityProvider", "client_id": "ocp01", "client_secret": "df685aee-253a-40e6-90aa-92686858115c", "claims": {"id": ["sub"], "preferredUsername": ["preferred_username"], "name": ["name"], "email": ["email"]}, "urls": {"authorize": "https://openidserver/auth/realms/master/protocol/openid-connect/auth", "token": "https://openidserver/auth/realms/master/protocol/openid-connect/token"}, "ca": "openidserver.crt"}]

# Identify Configuration - Active Directory
openshift_master_identity_providers:
  - name: "my_company"
    challenge: true
    login: true
    mappingMethod: claim
    kind: LDAPPasswordIdentityProvider
    attributes:
      id:
        - dn
      email:
        - mail
      name:
        - cn
      preferredUsername:
        - sAMAccountName
    bindDN: "CN=OpenShift_Svc_Accounts,OU=Service Accounts,OU=Administration,DC=subdomain,DC=company,DC=com"
    bindPassword: "bind_password_here"
    insecure: true
    url: "ldap://ldapserver:389/DC=subdomain,DC=company,DC=com?sAMAccountName"
  - name: htpasswd_auth
    login: true
    challenge: true
    kind: HTPasswdPasswordIdentityProvider
    filename: /etc/origin/master/htpasswd

# openshift_hosted_registry_storage_kind: glusterfs
openshift_master_cluster_method: native

# This is the internal facing DNS for masters
openshift_master_cluster_hostname: admin-internal.ocp-01.example.com

# This is the external facing DNS for masters
openshift_master_cluster_public_hostname: admin.ocp-01.example.com

# This is the external facing DNS for apps
#for use first infra node and do this: http://xip.io/

# wildcard domain for app routes
openshift_master_default_subdomain: apps.ocp-01.example.com

#  Provide local certificate paths which will be deployed to masters
# openshift_master_named_certificates: [{"certfile": "/root/openshift.crt", "keyfile": "/root/openshift.key", "cafile": "/root/ca-chain.pem"}]
openshift_master_overwrite_named_certificates: "True"
# openshift_hosted_router_certificate: {"certfile": "/root/wildcard.crt", "keyfile": "/root/wildcard.key", 'cafile': '/root/ca-chain.pem' }

# master certificate - change path below as required
openshift_master_named_certificates: [{"certfile": "/home/ansible-user/cluster_setup/certificates/admin", "keyfile": "/home/ansible-user/cluster_setup/certificates/certificates/key"}]

#  Install the openshift examples
openshift_install_examples: "True"

# Audit logging
# openshift_master_audit_config: {"basicAuditEnabled": "True"}
# openshift_master_audit_config: {"enabled": "True", "auditFilePath": "/var/log/openpaas-oscp-audit/openpaas-oscp-audit.log", "maximumFileRetentionDays": 14, "maximumFileSizeMegabytes": 500, "maximumRetainedFiles": 5}

openshift_node_kubelet_args: {'image-gc-high-threshold': ['90'], 'image-gc-low-threshold': ['80']}
openshift_router_selector: "region=infra"
openshift_registry_selector: "region=infra"
os_sdn_network_plugin_name: 'redhat/openshift-ovs-multitenant'

# custom sdn configuration - change to a different range as required
# osm_cluster_network_cidr: 192.168.0.0/16

# Logging
openshift_logging_install_logging: False
postdeploy_openshift_logging_install_logging: True

openshift_logging_install_eventrouter: False
postdeploy_openshift_logging_install_eventrouter: True

openshift_metrics_image_version: v3.9
openshift_logging_use_ops: False
openshift_logging_curator_default_days: 30
openshift_logging_kibana_replica_count: 2
openshift_logging_fluentd_audit_container_engine: True
openshift_logging_es_cluster_size: 3
openshift_logging_es_pvc_storage_class_name: glusterfs-storage-block
# This will trigger to call storageclass
openshift_logging_es_pvc_size: "10G"

openshift_hosted_metrics_deploy: False
postdeploy_openshift_hosted_metrics_deploy: True
postdeploy_openshift_metrics_install_metrics: True
openshift_metrics_install_metrics: False
openshift_metrics_hawkular_hostname: hawkular-metrics.apps.ocp-01.example.com
openshift_metrics_cassandra_limits_memory: 1Gi
openshift_metrics_hawkular_limits_memory: 2Gi
openshift_metrics_heapster_limits_memory: 1Gi

openshift_metrics_cassandra_nodeselector: {"region":"infra"}
openshift_metrics_hawkular_nodeselector: {"region":"infra"}
openshift_metrics_heapster_nodeselector: {"region":"infra"}
openshift_metrics_hawkular_agent_nodeselector: {"region":"infra"}
openshift_metrics_cassandra_storage_type: pv
openshift_metrics_cassandra_pvc_size: 10Gi
openshift_metrics_cassandra_pvc_storage_class_name: glusterfs-storage-block
openshift_metrics_cassanda_pvc_storage_class_name: glusterfs-storage-block

# storage - CRS Configurations
openshift_storage_glusterfs_is_native: False
openshift_storage_glusterfs_registry_is_native: False
openshift_storage_glusterfs_heketi_is_native: True

postdeploy_openshift_storage_glusterfs_heketi_is_native: True
glusterfs_heketi_topology_load: False
postdeploy_glusterfs_heketi_topology_load: True
openshift_storage_glusterfs_storageclass: False
postdeploy_openshift_storage_glusterfs_storageclass: True
glusterfs_block_storageclass: False
postdeploy_glusterfs_block_storageclass: True

openshift_storage_glusterfs_heketi_ssh_keyfile: /home/ansible-user/.ssh/id_rsa
openshift_storage_glusterfs_heketi_ssh_user: ansible-user
openshift_storage_glusterfs_heketi_ssh_sudo: True

openshift_storage_glusterfs_storageclass: True
openshift_storage_glusterfs_heketi_executor: ssh
openshift_storage_glusterfs_storageclass_default: True
openshift_storage_glusterfs_block_deploy: True
openshift_storage_glusterfs_block_host_vol_create: True
openshift_storage_glusterfs_block_host_vol_size: 20
openshift_storage_glusterfs_block_host_vol_max: 50
openshift_storage_glusterfs_block_storageclass: True
openshift_storage_glusterfs_image: registry.access.redhat.com/rhgs3/rhgs-server-rhel7
openshift_storage_glusterfs_block_image: registry.access.redhat.com/rhgs3/rhgs-gluster-block-prov-rhel7
openshift_storage_glusterfs_heketi_image: registry.access.redhat.com/rhgs3/rhgs-volmanager-rhel7

# security
os_firewall_use_firewalld: "True"

openshift_prometheus_pvc_size: 10Gi
openshift_prometheus_sc_name: glusterfs-storage-block
openshift_prometheus_storage_type: pvc
#
openshift_prometheus_alertmanager_pvc_size: 3Gi
openshift_prometheus_alertmanager_sc_name: glusterfs-storage-block
openshift_prometheus_alertmanager_storage_type: pvc
#
openshift_prometheus_alertbuffer_pvc_size: 3Gi
openshift_prometheus_alertbuffer_sc_name: glusterfs-storage-block
openshift_prometheus_alertbuffer_storage_type: pvc


[masters]
master0 ansible_host=host0003.example.com openshift_node_labels="{'node': 'false', 'region': 'master', 'zone': 'az1'}"
master1 ansible_host=host0002.example.com openshift_node_labels="{'node': 'false', 'region': 'master', 'zone': 'az2'}"
master2 ansible_host=host0004.example.com openshift_node_labels="{'node': 'false', 'region': 'master', 'zone': 'az3'}"

[etcd]
etcd0 ansible_host=host0003.example.com
etcd1 ansible_host=host0002.example.com
etcd2 ansible_host=host0004.example.com

[infra]
infra0 ansible_host=host0010.example.com openshift_node_labels="{'region': 'infra', 'zone': 'az1', 'site': 'a'}"
infra1 ansible_host=host0011.example.com openshift_node_labels="{'region': 'infra', 'zone': 'az2', 'site': 'b'}"
infra2 ansible_host=host0012.example.com openshift_node_labels="{'region': 'infra', 'zone': 'az3', 'site': 'c'}"
infra3 ansible_host=host0005.example.com openshift_node_labels="{'region': 'infra', 'zone': 'az3', 'site': 'd'}"

[compute]
compute0 ansible_host=host0001.example.com openshift_node_labels="{'node': 'true', 'region': 'primary', 'zone': 'az1', 'site': 'a'}"
compute1 ansible_host=host0003.example.com openshift_node_labels="{'node': 'true', 'region': 'primary', 'zone': 'az2', 'site': 'b'}"
compute2 ansible_host=host0005.example.com openshift_node_labels="{'node': 'true', 'region': 'primary', 'zone': 'az3', 'site': 'c'}"
compute3 ansible_host=host0004.example.com openshift_node_labels="{'node': 'true', 'region': 'primary', 'zone': 'az2', 'site': 'd'}"
compute4 ansible_host=host0002.example.com openshift_node_labels="{'node': 'true', 'region': 'primary', 'zone': 'az3', 'site': 'e'}"

# external GlusterFS Container Ready Storage (CRS) cluster nodes
[postdeploy_glusterfs]
storage0 ansible_host=host0009.example.com
storage1 ansible_host=host0008.example.com
storage2 ansible_host=host0007.example.com

[nodes:children]
masters
compute
infra
etcd

[controller]
controller1 ansible_host=host0002.example.com

[bastion]
bastion1 ansible_host=host0002.example.com