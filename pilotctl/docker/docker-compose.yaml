#
#    Onix Pilot Host Control Service
#    Copyright (c) 2018-2021 by www.gatblau.org
#    Licensed under the Apache License, Version 2.0 at http://www.apache.org/licenses/LICENSE-2.0
#    Contributors to this project, hereby assign copyright in this code to the project,
#    to be licensed under the same terms as the rest of the code.
#

# Note: Some ports in this Compose are deliberately exposed to the host where they
#       wouldn't normally be for a "production" system. This is so that developers
#       or technically minded users can test or debug areas of the system.

version: '3'

services:

  #############################################################################
  # Onix application services
  #############################################################################
  ox-app:
    image: ""
    depends_on:
      - db
      - ox-dbman
    container_name: ox-app
    restart: always
    environment:
      - DB_HOST=db
      - DB_USER=
      - DB_PWD=
      - DB_ADMIN_USER=
      - DB_ADMIN_PWD=
      - WAPI_AUTH_MODE=
      - WAPI_ADMIN_USER=
      - WAPI_ADMIN_PWD=
      - WAPI_EVENTS_ENABLED=
      - WAPI_EVENTS_SERVER_HOST=oxmsg
      - WAPI_EVENTS_SERVER_PORT=
    ports:
      - "8080:8080"

  pilotctl-app:
    image: 
    depends_on:
      - db
      - ox-app
      - pilotctl-dbman
    container_name: pilotctl-app
    restart: always
    environment:
      - OX_PILOTCTL_DB_HOST=db
      - OX_PILOTCTL_DB_USER=
      - OX_PILOTCTL_DB_PWD=
      - OX_HTTP_UNAME=
      - OX_HTTP_PWD=
      - OX_HTTP_PORT=
      - OX_WAPI_URI=:
      - OX_WAPI_USER=
      - OX_WAPI_PWD=
      - OX_WAPI_INSECURE_SKIP_VERIFY=true
      - OX_ART_REG_URI=
      - OX_ART_REG_USER=
      - OX_ART_REG_PWD=
    ports:
      - "8888:8888"
    volumes:
      - ./keys:/keys
      - ./conf:/conf

  # artreg-app:
  #   image: 
  #   container_name: artreg-app
  #   restart: always
  #   environment:
  #     - OXA_HTTP_UNAME=
  #     - OXA_HTTP_PORT=
  #     - OXA_HTTP_PWD=
  #     - OXA_HTTP_BACKEND_DOMAIN=:
  #   ports:
  #     - 8082:8082

  #############################################################################
  # Temporary utility services
  #############################################################################
  ox-dbman:
    image: 
    container_name: ox-dbman
    restart: always
    environment:
      - OX_DBM_DB_HOST=db
      - OX_DBM_DB_USERNAME=
      - OX_DBM_DB_PASSWORD=
      - OX_DBM_DB_ADMINUSERNAME=
      - OX_DBM_DB_ADMINPASSWORD=
      - OX_DBM_HTTP_USERNAME=
      - OX_DBM_HTTP_PASSWORD=
      - OX_DBM_HTTP_AUTHMODE=
      - OX_DBM_APPVERSION=
      - OX_DBM_REPO_URI=
    ports:
      - "8085:8085"

  pilotctl-dbman:
    image: 
    container_name: pilotctl-dbman
    restart: always
    environment:
      - OX_DBM_DB_HOST=db
      - OX_DBM_DB_NAME=pilotctl
      - OX_DBM_DB_USERNAME=
      - OX_DBM_DB_PASSWORD=
      - OX_DBM_DB_ADMINUSERNAME=
      - OX_DBM_DB_ADMINPASSWORD=
      - OX_DBM_HTTP_USERNAME=
      - OX_DBM_HTTP_PASSWORD=
      - OX_DBM_HTTP_AUTHMODE=
      - OX_DBM_APPVERSION=
      - OX_DBM_REPO_URI=
    ports:
      - "8086:8085"

  #############################################################################
  # Database services
  #############################################################################
  db: # (supports Onix and Pilot Control)
    image: 
    container_name: db
    restart: always
    environment:
      - POSTGRES_PASSWORD=
    volumes:
      - db:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  #############################################################################
  # Event Receiver services
  #############################################################################
  evr-mongo-app:
    image: 
    depends_on:
      - pilotctl-app
      - evr-mongo-db
    container_name: evr-mongo-app
    restart: always
    environment:
      - OX_MONGO_EVR_CONN=mongodb://:@:/
      - OX_HTTP_PORT=
      - OX_HTTP_UNAME=
      - OX_HTTP_PWD=
    ports:
      - ":8885"

  evr-mongo-db:
    image: 
    container_name: evr-mongo-db
    restart: always
    environment:
      - MONGO_INITDB_ROOT_USERNAME=
      - MONGO_INITDB_ROOT_PASSWORD=
    ports:
      - :27017
    volumes:
      - evr-mongo-db:/data/db
      - evr-mongo-dblogs:/var/log/mongodb


#############################################################################
# Networking
#############################################################################
networks:
  default:
    external:
      name: 

#############################################################################
# Data volumes
#############################################################################
volumes:
  db:
  evr-mongo-db:
  evr-mongo-dblogs:
